<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EpiEstim: a demonstration • EpiEstim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="EpiEstim: a demonstration">
<meta property="og:description" content="EpiEstim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EpiEstim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/EpiEstim_aggregated_data.html">EpiEstim for aggregated incidence data</a>
    </li>
    <li>
      <a href="../articles/MV_EpiEstim_vignette.html">MV-EpiEstim</a>
    </li>
    <li>
      <a href="../articles/alternative_software.html">Alternative software for estimating the reproduction number</a>
    </li>
    <li>
      <a href="../articles/full_EpiEstim_vignette.html">EpiEstim Vignette</a>
    </li>
    <li>
      <a href="../articles/short_demo.html">EpiEstim: a demonstration</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/EpiEstim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="short_demo_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>EpiEstim: a demonstration</h1>
                        <h4 data-toc-skip class="author">Anne Cori</h4>
            
            <h4 data-toc-skip class="date">2023-04-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/EpiEstim/blob/HEAD/vignettes/short_demo.Rmd" class="external-link"><code>vignettes/short_demo.Rmd</code></a></small>
      <div class="hidden name"><code>short_demo.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette provides a short demonstration of the package. We consider a dataset containing information on pandemic influenza. The dataset contains:</p>
<ol style="list-style-type: decimal">
<li><p>the daily incidence of onset of acute respiratory illness (ARI, defined as at least two symptoms among fever, cough, sore throat, and runny nose) amongst children in a school in Pennsylvania during the 2009 H1N1 influenza pandemic (see Cauchemez et al., PNAS, 2011),</p></li>
<li><p>the discrete daily distribution of the serial interval (time interval between symptoms onset in a case and in their infector) for influenza, assuming a shifted Gamma distribution with mean 2.6 days, standard deviation 1.5 days and shift 1 day (as in Ferguson et al., Nature, 2005).</p></li>
<li><p>interval-censored serial interval data from the 2009 outbreak of H1N1 influenza in San Antonio, Texas, USA (from Morgan et al., EID 2010).</p></li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/EpiEstim" class="external-link">EpiEstim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">)</span></span>
<span><span class="co">## incidence:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">)</span></span>
<span><span class="co">#&gt;        dates I</span></span>
<span><span class="co">#&gt; 1 2009-04-27 1</span></span>
<span><span class="co">#&gt; 2 2009-04-28 1</span></span>
<span><span class="co">#&gt; 3 2009-04-29 0</span></span>
<span><span class="co">#&gt; 4 2009-04-30 2</span></span>
<span><span class="co">#&gt; 5 2009-05-01 5</span></span>
<span><span class="co">#&gt; 6 2009-05-02 3</span></span>
<span><span class="co">## serial interval (SI) distribution:</span></span>
<span><span class="va">Flu2009</span><span class="op">$</span><span class="va">si_distr</span></span>
<span><span class="co">#&gt;  [1] 0.000 0.233 0.359 0.198 0.103 0.053 0.027 0.014 0.007 0.003 0.002 0.001</span></span>
<span><span class="co">## interval-ceonsored serial interval data:</span></span>
<span><span class="co">## each line represents a transmission event, </span></span>
<span><span class="co">## EL/ER show the lower/upper bound of the symptoms onset date in the infector</span></span>
<span><span class="co">## SL/SR show the same for the secondary case</span></span>
<span><span class="co">## type has entries 0 corresponding to doubly interval-censored data</span></span>
<span><span class="co">## (see Reich et al. Statist. Med. 2009).</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">si_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   EL ER SL SR type</span></span>
<span><span class="co">#&gt; 1  0  1  7  8    0</span></span>
<span><span class="co">#&gt; 2  0  1  2  3    0</span></span>
<span><span class="co">#&gt; 3  0  1  3  4    0</span></span>
<span><span class="co">#&gt; 4  0  1  2  5    0</span></span>
<span><span class="co">#&gt; 5  0  1  1  9    0</span></span>
<span><span class="co">#&gt; 6  0  1  2  4    0</span></span></code></pre></div>
<p>We can use the <code>incidence</code> R package to easily plot the daily incidence data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.repidemicsconsortium.org/incidence/" class="external-link">incidence</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/conversions.html" class="external-link">as.incidence</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">$</span><span class="va">I</span>, dates <span class="op">=</span> <span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">$</span><span class="va">dates</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The `guide` argument in `scale_*()` cannot be `FALSE`. This was deprecated in</span></span>
<span><span class="co">#&gt; ggplot2 3.3.4.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use "none" instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">incidence</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/reconhub/incidence/issues&gt;</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="figs-demo/incidence-1.png" width="576"></p>
<p>We can run <code>estimate_R</code> on the incidence data to estimate the reproduction number R. For this, we need to specify i) the time window(s) over which to estimate R and ii) information on the distribution of the serial interval.</p>
<p>For i), the default behavior is to estimate R over weekly sliding windows. This can be changed through the <code>config$t_start</code> and <code>config$t_end</code> arguments (see below, “Changing the time windows for estimation”). For ii), there are several options, specified in the <code>method</code> argument.</p>
<p>The simplest is the <code>parametric_si</code> method, where you only specify the mean and standard deviation of the SI.</p>
</div>
<div class="section level2">
<h2 id="estimating-r-on-sliding-weekly-windows-with-a-parametric-serial-interval">Estimating R on sliding weekly windows, with a parametric serial interval<a class="anchor" aria-label="anchor" href="#estimating-r-on-sliding-weekly-windows-with-a-parametric-serial-interval"></a>
</h2>
<p>In this example, we only specify the mean and standard deviation of the serial interval. In that case an offset gamma distribution is used for the serial interval. In the following example, we use the mean and standard deviation of the serial interval for flu from Ferguson et al., Nature, 2005:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_parametric_si</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>, </span>
<span>                                method<span class="op">=</span><span class="st">"parametric_si"</span>,</span>
<span>                                config <span class="op">=</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                                  mean_si <span class="op">=</span> <span class="fl">2.6</span>, </span>
<span>                                  std_si <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Default config will estimate R on weekly sliding windows.</span></span>
<span><span class="co">#&gt;     To change this change the t_start and t_end arguments.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res_parametric_si</span><span class="op">$</span><span class="va">R</span><span class="op">)</span></span>
<span><span class="co">#&gt;   t_start t_end  Mean(R)    Std(R) Quantile.0.025(R) Quantile.0.05(R)</span></span>
<span><span class="co">#&gt; 1       2     8 1.735798 0.4091314         1.0287437         1.121933</span></span>
<span><span class="co">#&gt; 2       3     9 1.749168 0.3647267         1.1088223         1.195480</span></span>
<span><span class="co">#&gt; 3       4    10 1.537058 0.3074116         0.9947030         1.068694</span></span>
<span><span class="co">#&gt; 4       5    11 1.431839 0.2705921         0.9514466         1.017661</span></span>
<span><span class="co">#&gt; 5       6    12 1.422725 0.2515046         0.9731426         1.035808</span></span>
<span><span class="co">#&gt; 6       7    13 1.635373 0.2523436         1.1786332         1.243590</span></span>
<span><span class="co">#&gt;   Quantile.0.25(R) Median(R) Quantile.0.75(R) Quantile.0.95(R)</span></span>
<span><span class="co">#&gt; 1         1.445198  1.703761         1.991520         2.458972</span></span>
<span><span class="co">#&gt; 2         1.491345  1.723884         1.979457         2.389121</span></span>
<span><span class="co">#&gt; 3         1.320090  1.516613         1.731761         2.075176</span></span>
<span><span class="co">#&gt; 4         1.241251  1.414830         1.603900         1.904047</span></span>
<span><span class="co">#&gt; 5         1.245996  1.407932         1.583340         1.860107</span></span>
<span><span class="co">#&gt; 6         1.458847  1.622413         1.797779         2.071372</span></span>
<span><span class="co">#&gt;   Quantile.0.975(R)</span></span>
<span><span class="co">#&gt; 1          2.624781</span></span>
<span><span class="co">#&gt; 2          2.533119</span></span>
<span><span class="co">#&gt; 3          2.195540</span></span>
<span><span class="co">#&gt; 4          2.008849</span></span>
<span><span class="co">#&gt; 5          1.956336</span></span>
<span><span class="co">#&gt; 6          2.165745</span></span></code></pre></div>
<p>The output of the estimate_r function is a list containing a number of elements, the most important of which is <code>R</code>, a data.frame containing details on the estimated reproduction number. Each line corresponds to one time window.</p>
<p>The output can be plotted as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_parametric_si</span>, legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs-demo/plot_r_parametric_si-1.png" width="576"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use `type = "R"`, `type = "incid"` or `type = "SI"` </span></span>
<span><span class="co"># to generate only one of the 3 plots</span></span></code></pre></div>
<p>This produces three graphs showing the incidence time series, the estimated reproduction number (posterior mean and 95\% credible interval, with estimates for a time window plotted at the end of the time window) and the discrete distribution of the serial interval.</p>
</div>
<div class="section level2">
<h2 id="estimating-r-with-a-non-parametric-serial-interval-distribution">Estimating R with a non parametric serial interval distribution<a class="anchor" aria-label="anchor" href="#estimating-r-with-a-non-parametric-serial-interval-distribution"></a>
</h2>
<p>If one already has a full distribution of the serial interval, and not only a mean and standard deviation, this can be fed into <code>estimate_r</code> as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_non_parametric_si</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>, </span>
<span>                                    method<span class="op">=</span><span class="st">"non_parametric_si"</span>,</span>
<span>                                    config <span class="op">=</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                                      si_distr <span class="op">=</span> <span class="va">Flu2009</span><span class="op">$</span><span class="va">si_distr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Default config will estimate R on weekly sliding windows.</span></span>
<span><span class="co">#&gt;     To change this change the t_start and t_end arguments.</span></span>
<span><span class="co"># si_distr gives the probability mass function of the serial interval for </span></span>
<span><span class="co"># time intervals 0, 1, 2, etc.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_non_parametric_si</span>, <span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs-demo/estimate_r_non_parametric_si-1.png" width="576"></p>
<p>Note that you can obtain such a full distribution of the serial interval using <code>discr_si</code> function (this is how <code>Flu2009$si_distr</code> was obtained, with additional rounding):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/discr_si.html">discr_si</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span>, mu <span class="op">=</span> <span class="fl">2.6</span>, sigma <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.000000e+00 2.331721e-01 3.585794e-01 1.981108e-01 1.033427e-01</span></span>
<span><span class="co">#&gt;  [6] 5.290518e-02 2.682146e-02 1.351620e-02 6.783438e-03 3.394351e-03</span></span>
<span><span class="co">#&gt; [11] 1.694674e-03 8.445945e-04 4.203313e-04 2.089422e-04 1.037609e-04</span></span>
<span><span class="co">#&gt; [16] 5.148480e-05 2.552773e-05 1.264952e-05 6.264667e-06 3.101068e-06</span></span>
<span><span class="co">#&gt; [21] 1.534394e-06</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimating-r-accounting-for-uncertainty-on-the-serial-interval-distribution">Estimating R accounting for uncertainty on the serial interval distribution<a class="anchor" aria-label="anchor" href="#estimating-r-accounting-for-uncertainty-on-the-serial-interval-distribution"></a>
</h2>
<p>Sometimes, especially early in outbreaks, the serial interval distribution can be poorly specified. Therefore <code>estimate_R</code> also allows integrating results over various distributions of the serial interval. To do so, the mean and sd of the serial interval are each drawn from truncated normal distributions, with parameters specified by the user, as in the example below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## we choose to draw:</span></span>
<span><span class="co">## - the mean of the SI in a Normal(2.6, 1), truncated at 1 and 4.2</span></span>
<span><span class="co">## - the sd of the SI in a Normal(1.5, 0.5), truncated at 0.5 and 2.5</span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean_si <span class="op">=</span> <span class="fl">2.6</span>, std_mean_si <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           min_mean_si <span class="op">=</span> <span class="fl">1</span>, max_mean_si <span class="op">=</span> <span class="fl">4.2</span>,</span>
<span>                           std_si <span class="op">=</span> <span class="fl">1.5</span>, std_std_si <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                           min_std_si <span class="op">=</span> <span class="fl">0.5</span>, max_std_si <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res_uncertain_si</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>,</span>
<span>                               method <span class="op">=</span> <span class="st">"uncertain_si"</span>,</span>
<span>                               config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span>
<span><span class="co">#&gt; Default config will estimate R on weekly sliding windows.</span></span>
<span><span class="co">#&gt;     To change this change the t_start and t_end arguments.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_uncertain_si</span>, legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
<p><img src="figs-demo/estimate_r_uncertain_si-1.png" width="576"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## the third plot now shows all the SI distributions considered</span></span></code></pre></div>
<p>Note that the results above are obtained numerically and thus can be slower to compute. You can adjust the parameters governing the sample sizes by altering the default values of <code>config$n1</code> and <code>config$n2</code> (<code>n1</code> is the number of pairs of mean and sd of the SI that are drawn and <code>n2</code> is the size of the posterior sample drawn for each pair of mean, sd of SI).</p>
</div>
<div class="section level2">
<h2 id="estimating-r-and-the-serial-interval-using-data-on-pairs-infectorinfected">Estimating R and the serial interval using data on pairs infector/infected<a class="anchor" aria-label="anchor" href="#estimating-r-and-the-serial-interval-using-data-on-pairs-infectorinfected"></a>
</h2>
<p>Usually, the serial interval distribution is estimated using data on the date of symptoms onset in pairs of infectors / infected individuals. The serial interval distribution estimate is then fed into reproduction number estimates. Typically, a single SI distribution is used to estimate the reproduction number throughout an outbreak.</p>
<p>This approach doesn’t account for uncertainty in the serial interval distribution, and doesn’t allow to incorporate data collected later in the outbreak which could inform the serial interval distribution.</p>
<p>In <code>estimate_R</code>, we now allow the serial interval distribution to be directly estimated, using MCMC, from interval censored exposure data. The reproduction number is then estimated using the posterior distribution of the SI, hence accounting for the uncertainty associated with this estimate.</p>
<p>As the epidemic progresses, newly collected exposure data can be incorporated to update the serial interval estimate.</p>
<p>This method is new to <code>EpiEstim</code> and described in a manuscript in preparation (Thompson et al.).</p>
<p>The <code>Flu2009</code> dataset contains interval-censored serial interval data from the 2009 outbreak of H1N1 influenza in San Antonio, Texas, USA (from Morgan et al., EID 2010).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## interval-ceonsored serial interval data:</span></span>
<span><span class="co">## each line represents a transmission event, </span></span>
<span><span class="co">## EL/ER show the lower/upper bound of the symptoms onset date in the infector</span></span>
<span><span class="co">## SL/SR show the same for the secondary case</span></span>
<span><span class="co">## type has entries 0 corresponding to doubly interval-censored data</span></span>
<span><span class="co">## (see Reich et al. Statist. Med. 2009).</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">si_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   EL ER SL SR type</span></span>
<span><span class="co">#&gt; 1  0  1  7  8    0</span></span>
<span><span class="co">#&gt; 2  0  1  2  3    0</span></span>
<span><span class="co">#&gt; 3  0  1  3  4    0</span></span>
<span><span class="co">#&gt; 4  0  1  2  5    0</span></span>
<span><span class="co">#&gt; 5  0  1  1  9    0</span></span>
<span><span class="co">#&gt; 6  0  1  2  4    0</span></span></code></pre></div>
<p>These can be used to estimate the SI within <code>estimate_R</code>, and produce estimates of the reproduction number based on the full SI posterior distribution:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## fixing the random seeds</span></span>
<span><span class="va">MCMC_seed</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">overall_seed</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">mcmc_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_mcmc_control.html">make_mcmc_control</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="va">MCMC_seed</span>, </span>
<span>                                  burnin <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="st">"G"</span> <span class="co"># fitting a Gamma dsitribution for the SI</span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>si_parametric_distr <span class="op">=</span> <span class="va">dist</span>,</span>
<span>                           mcmc_control <span class="op">=</span> <span class="va">mcmc_control</span>,</span>
<span>                           seed <span class="op">=</span> <span class="va">overall_seed</span>, </span>
<span>                           n1 <span class="op">=</span> <span class="fl">50</span>, </span>
<span>                           n2 <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res_si_from_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>,</span>
<span>                               method <span class="op">=</span> <span class="st">"si_from_data"</span>,</span>
<span>                               si_data <span class="op">=</span> <span class="va">Flu2009</span><span class="op">$</span><span class="va">si_data</span>,</span>
<span>                               config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span>
<span><span class="co">#&gt; Default config will estimate R on weekly sliding windows.</span></span>
<span><span class="co">#&gt;     To change this change the t_start and t_end arguments.</span></span>
<span><span class="co">#&gt; Running 1500 MCMC iterations </span></span>
<span><span class="co">#&gt; MCMCmetrop1R iteration 1 of 1500 </span></span>
<span><span class="co">#&gt; function value =  -27.68336</span></span>
<span><span class="co">#&gt; theta = </span></span>
<span><span class="co">#&gt;    1.67335</span></span>
<span><span class="co">#&gt;   -0.27928</span></span>
<span><span class="co">#&gt; Metropolis acceptance rate = 0.00000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMCmetrop1R iteration 1001 of 1500 </span></span>
<span><span class="co">#&gt; function value =  -29.17093</span></span>
<span><span class="co">#&gt; theta = </span></span>
<span><span class="co">#&gt;    1.07173</span></span>
<span><span class="co">#&gt;    0.18715</span></span>
<span><span class="co">#&gt; Metropolis acceptance rate = 0.54246</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span>
<span><span class="co">#&gt; The Metropolis acceptance rate was 0.55267</span></span>
<span><span class="co">#&gt; @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Gelman-Rubin MCMC convergence diagnostic was successful.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ </span></span>
<span><span class="co">#&gt; Estimating the reproduction number for these serial interval estimates...</span></span>
<span><span class="co">#&gt;  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_si_from_data</span>, legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs-demo/estimate_r_si_from_data-1.png" width="576"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## the third plot now shows the posterior sample of SI distributions </span></span>
<span><span class="co">## that were integrated over</span></span></code></pre></div>
<p>Now say you want to save your estimates of the serial interval first, and then use them within <code>estimate_R</code>. This can be useful e.g. if you want to explore several time windows for R estimation, but based on the same SI data, and so you don’t want to run the MCMC to estimate the SI within <code>estimate_R</code> every time. You can do this as follow:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## using the same random seeds as before to be able to compare results</span></span>
<span></span>
<span><span class="co">## first estimate the SI distribution using function dic.fit.mcmc fron </span></span>
<span><span class="co">## coarseDataTools package:</span></span>
<span><span class="va">n_mcmc_samples</span> <span class="op">&lt;-</span> <span class="va">config</span><span class="op">$</span><span class="va">n1</span><span class="op">*</span><span class="va">mcmc_control</span><span class="op">$</span><span class="va">thin</span></span>
<span><span class="va">SI_fit</span> <span class="op">&lt;-</span> <span class="fu">coarseDataTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coarseDataTools/man/dic.fit.mcmc.html" class="external-link">dic.fit.mcmc</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Flu2009</span><span class="op">$</span><span class="va">si_data</span>,</span>
<span>                  dist <span class="op">=</span> <span class="va">dist</span>,</span>
<span>                  init.pars <span class="op">=</span> <span class="fu"><a href="../reference/init_mcmc_params.html">init_mcmc_params</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">si_data</span>, <span class="va">dist</span><span class="op">)</span>,</span>
<span>                  burnin <span class="op">=</span> <span class="va">mcmc_control</span><span class="op">$</span><span class="va">burnin</span>,</span>
<span>                  n.samples <span class="op">=</span> <span class="va">n_mcmc_samples</span>,</span>
<span>                  seed <span class="op">=</span> <span class="va">mcmc_control</span><span class="op">$</span><span class="va">seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running 1500 MCMC iterations </span></span>
<span><span class="co">#&gt; MCMCmetrop1R iteration 1 of 1500 </span></span>
<span><span class="co">#&gt; function value =  -27.68336</span></span>
<span><span class="co">#&gt; theta = </span></span>
<span><span class="co">#&gt;    1.67335</span></span>
<span><span class="co">#&gt;   -0.27928</span></span>
<span><span class="co">#&gt; Metropolis acceptance rate = 0.00000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMCmetrop1R iteration 1001 of 1500 </span></span>
<span><span class="co">#&gt; function value =  -29.17093</span></span>
<span><span class="co">#&gt; theta = </span></span>
<span><span class="co">#&gt;    1.07173</span></span>
<span><span class="co">#&gt;    0.18715</span></span>
<span><span class="co">#&gt; Metropolis acceptance rate = 0.54246</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span>
<span><span class="co">#&gt; The Metropolis acceptance rate was 0.55267</span></span>
<span><span class="co">#&gt; @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span>
<span><span class="co">## thinning the output of the MCMC and converting using coarse2estim function</span></span>
<span><span class="va">si_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coarse2estim.html">coarse2estim</a></span><span class="op">(</span><span class="va">SI_fit</span>, thin <span class="op">=</span> <span class="va">mcmc_control</span><span class="op">$</span><span class="va">thin</span><span class="op">)</span><span class="op">$</span><span class="va">si_sample</span></span>
<span><span class="va">res_si_from_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>,</span>
<span>                                method <span class="op">=</span> <span class="st">"si_from_sample"</span>,</span>
<span>                                si_sample <span class="op">=</span> <span class="va">si_sample</span>,</span>
<span>                                config <span class="op">=</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n2 <span class="op">=</span> <span class="fl">50</span>, </span>
<span>                                seed <span class="op">=</span> <span class="va">overall_seed</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Default config will estimate R on weekly sliding windows.</span></span>
<span><span class="co">#&gt;     To change this change the t_start and t_end arguments.</span></span>
<span></span>
<span><span class="co">## check that res_si_from_sample is the same as res_si_from_data</span></span>
<span><span class="co">## since they were generated using the same MCMC algorithm to generate the SI</span></span>
<span><span class="co">## sample (either internally to EpiEstim or externally)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">res_si_from_sample</span><span class="op">$</span><span class="va">R</span><span class="op">$</span><span class="va">`Mean(R)`</span> <span class="op">==</span> <span class="va">res_si_from_data</span><span class="op">$</span><span class="va">R</span><span class="op">$</span><span class="va">`Mean(R)`</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="changing-the-time-windows-for-estimation">Changing the time windows for estimation<a class="anchor" aria-label="anchor" href="#changing-the-time-windows-for-estimation"></a>
</h2>
<p>The time window can be specified through arguments <code>config$t_start</code> and <code>config$t_end</code>. For instance, the default weekly sliding windows can also be obtained by specifying:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">)</span></span>
<span><span class="va">t_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="cn">T</span><span class="op">-</span><span class="fl">6</span><span class="op">)</span> <span class="co"># starting at 2 as conditional on the past observations</span></span>
<span><span class="va">t_end</span> <span class="op">&lt;-</span> <span class="va">t_start</span> <span class="op">+</span> <span class="fl">6</span> <span class="co"># adding 6 to get 7-day windows as bounds included in window</span></span>
<span><span class="va">res_weekly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>, </span>
<span>                         method<span class="op">=</span><span class="st">"parametric_si"</span>,</span>
<span>                         config <span class="op">=</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                           t_start <span class="op">=</span> <span class="va">t_start</span>,</span>
<span>                           t_end <span class="op">=</span> <span class="va">t_end</span>,</span>
<span>                           mean_si <span class="op">=</span> <span class="fl">2.6</span>, </span>
<span>                           std_si <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_weekly</span>, <span class="st">"R"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="figs-demo/estimate_r_weekly-1.png" width="576"></p>
<p>For biweekly estimates:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="cn">T</span><span class="op">-</span><span class="fl">13</span><span class="op">)</span> <span class="co"># starting at 2 as conditional on the past observations</span></span>
<span><span class="va">t_end</span> <span class="op">&lt;-</span> <span class="va">t_start</span> <span class="op">+</span> <span class="fl">13</span> </span>
<span><span class="va">res_biweekly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>, </span>
<span>                           method<span class="op">=</span><span class="st">"parametric_si"</span>,</span>
<span>                           config <span class="op">=</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                             t_start <span class="op">=</span> <span class="va">t_start</span>,</span>
<span>                             t_end <span class="op">=</span> <span class="va">t_end</span>,</span>
<span>                             mean_si <span class="op">=</span> <span class="fl">2.6</span>, </span>
<span>                             std_si <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_biweekly</span>, <span class="st">"R"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="figs-demo/estimate_r_biweekly-1.png" width="576"></p>
<p>So far we have used estimates on sliding windows. Sometimes it may be useful to consider consecutive non overlapping windows as well. For instance, in the flu outbreak we are considering, the school closed from 14th to 20th May 2009, i.e. days 18 to 24 in our dataset (Cauchemez et al., PNAS, 2011). It is interesting to estimate the reproduction number before, during, and after the school closure to assess whether this had an impact on transmissibility.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">18</span>, <span class="fl">25</span><span class="op">)</span> <span class="co"># starting at 2 as conditional on the past observations</span></span>
<span><span class="va">t_end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">24</span>, <span class="fl">32</span><span class="op">)</span></span>
<span><span class="va">res_before_during_after_closure</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>, </span>
<span>                                              method<span class="op">=</span><span class="st">"parametric_si"</span>,</span>
<span>                                              config <span class="op">=</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                                                t_start <span class="op">=</span> <span class="va">t_start</span>,</span>
<span>                                                t_end <span class="op">=</span> <span class="va">t_end</span>,</span>
<span>                                                mean_si <span class="op">=</span> <span class="fl">2.6</span>, </span>
<span>                                                std_si <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_before_during_after_closure</span>, <span class="st">"R"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs-demo/estimate_r_before_during_after_closure-1.png" width="576"></p>
<p>The results above suggest that the school closure was effective in terms of reducing transmissibility, as the estimated reproduction number during the school closure was significantly lower than that before closure, and was estimated to be under the threshold value 1.</p>
</div>
<div class="section level2">
<h2 id="different-ways-of-specifying-the-incidence">Different ways of specifying the incidence<a class="anchor" aria-label="anchor" href="#different-ways-of-specifying-the-incidence"></a>
</h2>
<p>So far we have specified the <code>incid</code> argument using a table with two columns indicating the dates and the number of incident cases for each date.</p>
<p><code>estimate_R</code> accepts a range of formats for its <code>incid</code> argument.</p>
<p>This can be a table, as we’ve seen. In that case there needs to be a column called <code>I</code> containing the number of incident cases. If a column <code>dates</code> is present it is used in the x-axes when producing plots:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">)</span></span>
<span><span class="co">#&gt;        dates I</span></span>
<span><span class="co">#&gt; 1 2009-04-27 1</span></span>
<span><span class="co">#&gt; 2 2009-04-28 1</span></span>
<span><span class="co">#&gt; 3 2009-04-29 0</span></span>
<span><span class="co">#&gt; 4 2009-04-30 2</span></span>
<span><span class="co">#&gt; 5 2009-05-01 5</span></span>
<span><span class="co">#&gt; 6 2009-05-02 3</span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean_si <span class="op">=</span> <span class="fl">2.6</span>, std_si <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res_incid_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>, </span>
<span>                              method<span class="op">=</span><span class="st">"parametric_si"</span>,</span>
<span>                              config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span>
<span><span class="co">#&gt; Default config will estimate R on weekly sliding windows.</span></span>
<span><span class="co">#&gt;     To change this change the t_start and t_end arguments.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_incid_table</span>, <span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs-demo/incid_table-1.png" width="576"></p>
<p>It can just be a vector (but then the x-axis in your plots is measured in time steps since start of the outbreak)</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_incid_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">$</span><span class="va">I</span>, </span>
<span>                               method<span class="op">=</span><span class="st">"parametric_si"</span>,</span>
<span>                               config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span>
<span><span class="co">#&gt; Default config will estimate R on weekly sliding windows.</span></span>
<span><span class="co">#&gt;     To change this change the t_start and t_end arguments.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_incid_vector</span>, <span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs-demo/incid_vector-1.png" width="576"></p>
<p>Finally, <code>incid</code> can be an object of the class <code>incidence</code>, as created for instance by the function <code>incidence</code> of the <code>incidence</code> package.</p>
<p>Let’s artificially create a line-list corresponding to our flu incidence data:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates_onset</span> <span class="op">&lt;-</span> <span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">$</span><span class="va">dates</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">$</span><span class="va">I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>and now use the <code>incidence</code> function to generate an object that we feed to <code>estimate_R</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">last_date</span> <span class="op">&lt;-</span> <span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="cn">T</span><span class="op">]</span></span>
<span><span class="va">res_incid_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html" class="external-link">incidence</a></span><span class="op">(</span><span class="va">dates_onset</span>, last_date <span class="op">=</span> <span class="va">last_date</span><span class="op">)</span>, </span>
<span>                              method<span class="op">=</span><span class="st">"parametric_si"</span>,</span>
<span>                              config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span>
<span><span class="co">#&gt; Default config will estimate R on weekly sliding windows.</span></span>
<span><span class="co">#&gt;     To change this change the t_start and t_end arguments.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_incid_class</span>, <span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs-demo/incid_class-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="specifying-imported-cases">Specifying imported cases<a class="anchor" aria-label="anchor" href="#specifying-imported-cases"></a>
</h2>
<p>All of the above assumes that all cases are linked by local transmission. Sometimes you may have information (from field epidemiological investigations for instance) indicating that some cases are in fact imported (from another location, or from an animal reservoir). We allow to include such information, when available, as illustrated in the example below:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generating fake information on our cases:</span></span>
<span><span class="va">location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"local"</span>,<span class="st">"imported"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dates_onset</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">location</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"imported"</span> <span class="co"># forcing the first case to be imported</span></span>
<span></span>
<span><span class="co">## get incidence per group (location)</span></span>
<span><span class="va">incid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.repidemicsconsortium.org/incidence/reference/incidence.html" class="external-link">incidence</a></span><span class="op">(</span><span class="va">dates_onset</span>, groups <span class="op">=</span> <span class="va">location</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">incid</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs-demo/imports-1.png" width="576"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Estimate R with assumptions on serial interval</span></span>
<span><span class="va">res_with_imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_R.html">estimate_R</a></span><span class="op">(</span><span class="va">incid</span>, method <span class="op">=</span> <span class="st">"parametric_si"</span>,</span>
<span>                   config <span class="op">=</span> <span class="fu"><a href="../reference/make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                   mean_si <span class="op">=</span> <span class="fl">2.6</span>, std_si <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Default config will estimate R on weekly sliding windows.</span></span>
<span><span class="co">#&gt;     To change this change the t_start and t_end arguments.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_with_imports</span>, add_imported_cases<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; The number of colors (8) did not match the number of groups (2).</span></span>
<span><span class="co">#&gt; Using `col_pal` instead.</span></span></code></pre></div>
<p><img src="figs-demo/imports-2.png" width="576"></p>
<p>Note that in the above the estimated reproduction number is, as expected, much lower than estimated before when assuming that all cases were linked by local transmission.</p>
<p>This feature is new to <code>EpiEstim</code> and described in a manuscript in preparation (Thompson et al.).</p>
</div>
<div class="section level2">
<h2 id="epiestimapp">EpiEstimApp<a class="anchor" aria-label="anchor" href="#epiestimapp"></a>
</h2>
<p>We have a shiny app in development which integrates all the features presented above. You can follow its developments here: <a href="https://github.com/jstockwin/EpiEstimApp" class="external-link">https://github.com/jstockwin/EpiEstimApp</a> Please note the app is still in development!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Anne Cori.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
