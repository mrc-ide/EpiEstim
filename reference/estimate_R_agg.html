<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Estimated Instantaneous Reproduction Number from coarsely aggregated data — estimate_R_agg • EpiEstim</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Estimated Instantaneous Reproduction Number from coarsely aggregated data — estimate_R_agg"><meta property="og:description" content="Estimated Instantaneous Reproduction Number from coarsely aggregated data"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EpiEstim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/alternative_software.html">Alternative software for estimating the reproduction number</a>
    </li>
    <li>
      <a href="../articles/EpiEstim_aggregated_data.html">EpiEstim for aggregated incidence data</a>
    </li>
    <li>
      <a href="../articles/EpiEstim_backimputation.html">Dealing with missed generations of infections with EpiEstim</a>
    </li>
    <li>
      <a href="../articles/full_EpiEstim_vignette.html">EpiEstim Vignette</a>
    </li>
    <li>
      <a href="../articles/MV_EpiEstim_vignette.html">MV-EpiEstim</a>
    </li>
    <li>
      <a href="../articles/short_demo.html">EpiEstim: a demonstration</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mrc-ide/EpiEstim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimated Instantaneous Reproduction Number from coarsely aggregated data</h1>
    <small class="dont-index">Source: <a href="https://github.com/mrc-ide/EpiEstim/blob/master/R/estimate_R_agg.R" class="external-link"><code>R/estimate_R_agg.R</code></a></small>
    <div class="hidden name"><code>estimate_R_agg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimated Instantaneous Reproduction Number from coarsely aggregated data</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_R_agg</span><span class="op">(</span></span>
<span>  <span class="va">incid</span>,</span>
<span>  dt <span class="op">=</span> <span class="fl">7L</span>,</span>
<span>  dt_out <span class="op">=</span> <span class="fl">7L</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  recon_opt <span class="op">=</span> <span class="st">"naive"</span>,</span>
<span>  config <span class="op">=</span> <span class="fu"><a href="make_config.html">make_config</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"non_parametric_si"</span>, <span class="st">"parametric_si"</span><span class="op">)</span>,</span>
<span>  grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>precision <span class="op">=</span> <span class="fl">0.001</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-incid">incid<a class="anchor" aria-label="anchor" href="#arg-incid"></a></dt>
<dd><p>aggregated incidence data, supplied as a vector</p></dd>


<dt id="arg-dt">dt<a class="anchor" aria-label="anchor" href="#arg-dt"></a></dt>
<dd><p>length of temporal aggregations of the incidence data. This should
be an integer or vector of integers. If a vector, this will be recycled. For
example, <code>dt = c(3L, 4L)</code> would correspond to alternating incidence
aggregation windows of 3 and 4 days. The default value is 7 time units
(typically days) - see details.</p></dd>


<dt id="arg-dt-out">dt_out<a class="anchor" aria-label="anchor" href="#arg-dt-out"></a></dt>
<dd><p>length of the sliding windows used for R estimates (numeric,
7 time units (typically days)  by default). Only used if <code>dt &gt; 1</code>; in
this case this will supersede config$t_start and config$t_end, see estimate_R().</p></dd>


<dt id="arg-iter">iter<a class="anchor" aria-label="anchor" href="#arg-iter"></a></dt>
<dd><p>number of iterations of the EM algorithm (integer, 10 by default)</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>tolerance used in the convergence check (numeric, 1e-6 by default)</p></dd>


<dt id="arg-recon-opt">recon_opt<a class="anchor" aria-label="anchor" href="#arg-recon-opt"></a></dt>
<dd><p>one of "naive" or "match" (see details).</p></dd>


<dt id="arg-config">config<a class="anchor" aria-label="anchor" href="#arg-config"></a></dt>
<dd><p>an object of class <code>estimate_R_config</code>, as returned by
function <code>make_config</code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>one of "non_parametric_si" or "parametric_si" (see details).</p></dd>


<dt id="arg-grid">grid<a class="anchor" aria-label="anchor" href="#arg-grid"></a></dt>
<dd><p>named list containing "precision", "min", and "max" which are used to
define a grid of growth rate parameters that are used inside the EM algorithm
(see details). We recommend using the default values.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>an object of class <code>estimate_R</code>, with components:
</p><ul><li><p>R: a dataframe containing:
the times of start and end of each time window considered ;
the posterior mean, std, and 0.025, 0.05, 0.25, 0.5, 0.75, 0.95, 0.975
quantiles of the reproduction number for each time window.</p></li>
<li><p>method: the method used to estimate R, one of "non_parametric_si",
"parametric_si", "uncertain_si", "si_from_data" or "si_from_sample"</p></li>
<li><p>si_distr: a vector or dataframe (depending on the method) containing
 the discrete serial interval distribution(s) used for estimation</p></li>
<li><p>SI.Moments: a vector or dataframe (depending on the method)
containing the mean and std of the discrete serial interval distribution(s)
used for estimation</p></li>
<li><p>I: the time series of daily incidence reconstructed by the EM algorithm.
For the initial incidence that cannot be reconstructed (e.g. the first aggregation
window and aggregation windows where incidence is too low to estimate Rt - see
details) then the incidence returned will be the naive disaggregation of the
incidence data used to initialise the EM algorithm.</p></li>
<li><p>I_local: the time series of incidence of local cases (so that
<code>I_local + I_imported = I</code>)</p></li>
<li><p>I_imported: the time series of incidence of imported cases (so that
<code>I_local + I_imported = I</code>)</p></li>
<li><p>dates: a vector of dates corresponding to the incidence time series</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>Estimation of the time-varying reproduction number from temporally-aggregated
incidence data. For full details about how Rt is estimated within this
bayesian framework, see details in <code><a href="estimate_R.html">estimate_R</a></code>.</p>
<p>Here, an expectation maximisation (EM) algorithm is used to reconstruct daily
incidence from data that is provided on another timescale. In addition to the
usual parameters required in <code>estimate_R</code>, the <code>estimate_R_agg()</code>
function requires that the user specify two additional parameters: dt and
dt_out. There are two other parameters that the user may modify, iter and
grid, however we recommend that the default values are used.</p>
<ul><li><p>dt is the length of the temporal aggregations of the incidence data in
days. This can be a single integer if the aggregations do not change. E.g.
for weekly data, the user would supply dt = 7L. If the aggregation windows
vary in length, a vector of integers can be supplied. If the aggregations
have a repeating pattern, for instance, if incidence is always reported three
times per week on the same day of the week, you can supply a vector such as:
dt = c(2L,2L,3L). If the aggregations change over time, or do not have a
repeating pattern, the user can supply a full vector of aggregations matching
the length of the incidence data supplied.</p></li>
<li><p>dt_out is the length of the sliding window used to estimate Rt from the
reconstructed daily data. By default, Rt estimation uses weekly sliding time
windows, however, we recommend that the sliding window is at least equal to
the length of the longest aggregation window (dt) in the data.</p></li>
<li><p>recon_opt specifies how to handle the initial incidence data that cannot
be reconstructed by the EM algorithm (e.g. the incidence data for the aggregation
window that precedes the first aggregation window that R can be estimated for).
If `"naive"` is chosen, the naive disaggregation of the incidence data will be
kept. If `"match"` is chosen, the incidence in the preceding aggregation window
will be reconstructed by assuming that the growth rate matches that of the first
estimation window. This is `"naive"` by default.</p></li>
<li><p>iter is the number of iterations of the EM algorithm used to reconstruct
the daily incidence data. By default, iter = 10L, which has been demonstrated
to exceed the number of iterations necessary to reach convergence in simulation
studies and analysis of real-world data by the package authors (manuscript in
prep).</p></li>
<li><p>grid is a named list containing "precision", "min", and "max" which are
used to define a grid of growth rate parameters used inside the EM algorithm.
The grid is used to convert reproduction number estimates for each aggregation
of incidence data into growth rates, which are then used to reconstruct the
daily incidence data assuming exponential growth. The grid will auto-adjust
if it is not large enough, so we recommend using the default values.</p></li>
</ul><p>There are three stages of the EM algorithm:</p><ul><li><p>Initialisation. The EM algorithm is initialised with a naive disaggregation
of the incidence data. For example, if there were 70 cases over the course of a
week, this would be naively split into 10 cases per day.</p></li>
<li><p>Expectation. The reproduction number is estimated for each aggregation
window, except for the first aggregation window (as there is no past incidence
data). This means that the earliest the incidence reconstruction can start is
at least the first day of the second aggregation window. Additionally, if the
disaggregated incidence in subsequent aggregation windows is too low to estimate
the reproduction number, this will mean that the reconstruction will not start
until case numbers are sufficiently high.</p></li>
<li><p>Maximisation. The reproduction number estimates are then translated
into growth rates for each aggregation window (Wallinga &amp; Lipsitch, 2007) and
used to reconstruct daily incidence data assuming exponential growth. The daily
incidence is adjusted by a constant to ensure that if the daily incidence were
to be re-aggregated, it would still sum to the original aggregated totals. The
expectation and maximisation steps repeat iteratively until convergence.</p></li>
</ul><p>The daily incidence that is reconstructed after the final iteration of the EM
algorithm is then used to estimate Rt using the same process as the original
<code>estimate_R</code> function, with sliding weekly time windows used as the default.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Nash RK, Cori A, Nouvellet P. Estimating the epidemic reproduction number from
temporally aggregated incidence data: a statistical modelling approach and software
tool. medRxiv pre-print. (medRxiv pre-print)Wallinga &amp; Lipsitch. How generation intervals shape the relationship between
growth rates and reproductive numbers (Proc Biol Sci 2007).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">
<ul><li><p><code><a href="estimate_R.html">estimate_R</a></code> for details of the core function</p></li>
</ul></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Rebecca Nash <a href="mailto:r.nash@imperial.ac.uk">r.nash@imperial.ac.uk</a> and Anne Cori <a href="mailto:a.cori@imperial.ac.uk">a.cori@imperial.ac.uk</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Example for constant aggregation windows e.g. weekly reporting</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load data on SARS in 2003</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SARS2003"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># this is daily data, but for this example we will aggregate it to weekly </span></span></span>
<span class="r-in"><span><span class="co"># counts using the `aggregate_inc()` function</span></span></span>
<span class="r-in"><span><span class="va">incid</span> <span class="op">&lt;-</span> <span class="va">SARS2003</span><span class="op">$</span><span class="va">incidence</span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">7L</span></span></span>
<span class="r-in"><span><span class="va">weekly_incid</span> <span class="op">&lt;-</span> <span class="fu"><a href="aggregate_inc.html">aggregate_inc</a></span><span class="op">(</span><span class="va">incid</span>, <span class="va">dt</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Incidence aggregated up to day 105 of 107</span>
<span class="r-in"><span><span class="va">si_distr</span> <span class="op">&lt;-</span> <span class="va">SARS2003</span><span class="op">$</span><span class="va">si_distr</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># estimate Rt using the default parameters (method "non_parametric_si")</span></span></span>
<span class="r-in"><span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"non_parametric_si"</span></span></span>
<span class="r-in"><span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>si_distr <span class="op">=</span> <span class="va">si_distr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_weekly</span> <span class="op">&lt;-</span> <span class="fu">estimate_R_agg</span><span class="op">(</span>incid <span class="op">=</span> <span class="va">weekly_incid</span>, </span></span>
<span class="r-in"><span>                            dt <span class="op">=</span> <span class="fl">7L</span>, <span class="co"># aggregation window of the data</span></span></span>
<span class="r-in"><span>                            dt_out <span class="op">=</span> <span class="fl">7L</span>, <span class="co"># desired sliding window length</span></span></span>
<span class="r-in"><span>                            iter <span class="op">=</span> <span class="fl">10L</span>,</span></span>
<span class="r-in"><span>                            config <span class="op">=</span> <span class="va">config</span>,</span></span>
<span class="r-in"><span>                            method <span class="op">=</span> <span class="va">method</span>,</span></span>
<span class="r-in"><span>                            grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>precision <span class="op">=</span> <span class="fl">0.001</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 1</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 2</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 3</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 4</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 5</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 6</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 7</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 8</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 8</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 9</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 9</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 10</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 10</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> R estimation starts on day 8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the result</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_weekly</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_R_agg-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example using repeating vector of aggregation windows e.g. for consistent </span></span></span>
<span class="r-in"><span><span class="co">## reporting 3 times a week</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using the SARS data again</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SARS2003"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For this example we will pretend data is being reported three times a week,</span></span></span>
<span class="r-in"><span><span class="co"># in 2-day, 2-day, 3-day aggregations</span></span></span>
<span class="r-in"><span><span class="va">incid</span> <span class="op">&lt;-</span> <span class="va">SARS2003</span><span class="op">$</span><span class="va">incidence</span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>,<span class="fl">2L</span>,<span class="fl">3L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">agg_incid</span> <span class="op">&lt;-</span> <span class="fu"><a href="aggregate_inc.html">aggregate_inc</a></span><span class="op">(</span><span class="va">incid</span>, <span class="va">dt</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Incidence aggregated up to day 107 of 107</span>
<span class="r-in"><span><span class="va">si_distr</span> <span class="op">&lt;-</span> <span class="va">SARS2003</span><span class="op">$</span><span class="va">si_distr</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># estimate Rt using the default parameters (method "non_parametric_si")</span></span></span>
<span class="r-in"><span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"non_parametric_si"</span></span></span>
<span class="r-in"><span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>si_distr <span class="op">=</span> <span class="va">si_distr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_agg</span> <span class="op">&lt;-</span> <span class="fu">estimate_R_agg</span><span class="op">(</span>incid <span class="op">=</span> <span class="va">agg_incid</span>, </span></span>
<span class="r-in"><span>                            dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>,<span class="fl">2L</span>,<span class="fl">3L</span><span class="op">)</span>, <span class="co"># aggregation windows of the data</span></span></span>
<span class="r-in"><span>                            dt_out <span class="op">=</span> <span class="fl">7L</span>, <span class="co"># desired sliding window length</span></span></span>
<span class="r-in"><span>                            iter <span class="op">=</span> <span class="fl">10L</span>,</span></span>
<span class="r-in"><span>                            config <span class="op">=</span> <span class="va">config</span>,</span></span>
<span class="r-in"><span>                            method <span class="op">=</span> <span class="va">method</span>,</span></span>
<span class="r-in"><span>                            grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>precision <span class="op">=</span> <span class="fl">0.001</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 1</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 2</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 3</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 4</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 5</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 6</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 7</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 8</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 8</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 9</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 9</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 10</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 10</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> R estimation starts on day 8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the result</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_agg</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_R_agg-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example using full vector of aggregation windows</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>,<span class="fl">2L</span>,<span class="fl">3L</span><span class="op">)</span>, length.out<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">agg_incid</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">si_distr</span> <span class="op">&lt;-</span> <span class="va">SARS2003</span><span class="op">$</span><span class="va">si_distr</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># estimate Rt using the default parameters (method "non_parametric_si")</span></span></span>
<span class="r-in"><span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"non_parametric_si"</span></span></span>
<span class="r-in"><span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_config.html">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>si_distr <span class="op">=</span> <span class="va">si_distr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_agg</span> <span class="op">&lt;-</span> <span class="fu">estimate_R_agg</span><span class="op">(</span>incid <span class="op">=</span> <span class="va">agg_incid</span>, </span></span>
<span class="r-in"><span>                            dt <span class="op">=</span> <span class="va">dt</span>, <span class="co"># aggregation windows of the data</span></span></span>
<span class="r-in"><span>                            dt_out <span class="op">=</span> <span class="fl">7L</span>, <span class="co"># desired sliding window length</span></span></span>
<span class="r-in"><span>                            iter <span class="op">=</span> <span class="fl">10L</span>,</span></span>
<span class="r-in"><span>                            config <span class="op">=</span> <span class="va">config</span>,</span></span>
<span class="r-in"><span>                            method <span class="op">=</span> <span class="va">method</span>,</span></span>
<span class="r-in"><span>                            grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>precision <span class="op">=</span> <span class="fl">0.001</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 1</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 2</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 3</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 4</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 5</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 6</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 7</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 8</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 8</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 9</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 9</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated R for iteration: 10</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reconstructed incidence for iteration: 10</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're estimating R too early in the epidemic to get the desired</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>             posterior CV.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> R estimation starts on day 8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the result</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_agg</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_R_agg-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Anne Cori.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

